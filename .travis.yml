dist: trusty
sudo: false
language: node_js
node_js:
  - "6"
os:
  - linux
cache: yarn
env: 
  - FIREFOX_VERSION="latest"
  - FIREFOX_VERSION="59.0.2"

before_install:
  # Install firefox for testing.
  - echo $FIREFOX_VERSION
  - export FIREFOX_SOURCE_URL='https://download.mozilla.org/?product=firefox-'$FIREFOX_VERSION'&lang=en-US&os=linux64'
  - wget --no-verbose -O /tmp/firefox-$FIREFOX_VERSION.tar.bz2 $FIREFOX_SOURCE_URL
  - mkdir /tmp/firefox-$FIREFOX_VERSION
  - tar -xvf /tmp/firefox-$FIREFOX_VERSION.tar.bz2 -C /tmp/firefox-$FIREFOX_VERSION
  - export PATH=/tmp/firefox-$FIREFOX_VERSION/firefox:$PATH 
  # Use a virtual display.
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  # Install latest chrome.
  - export CHROME_BIN=/usr/bin/google-chrome
  # Use newer Yarn version
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.3.2
  - export PATH="$HOME/.yarn/bin:$PATH"
  - sudo apt-get update
  - sudo apt-get install -y libappindicator1 fonts-liberation google-chrome-stable
install:
  - yarn install
script:
  - npm run lint
  - firefox --version
  - npm run test:once
  - npm run integration
  - npm run coverage

# deployment
after_success:
  - cd dist/
deploy:
  skip_cleanup: true # stay in working dir (dist/)
  provider: npm
  email: service.eng@akquinet.de
  api_key:
    secure: pR4+ZcnGEq+JxK7aSy1xPOt5A3AdHROBUC8hjliH+tcHxqe92b7gzmtszNAEq122DnwA3+QdvGtQ01Gtq3up9HmAgdb4cPJlUgsWtjj5DtshwGXlO3qCvSzRqo7SS6eE08qAvzPRlLh0/w699TsHcpTqHuY1A/kRsV0gzxqpbRxY0Z1TabuM97hXdIaYyyWyNtZoQ79j6K5dUFGTBd0TFSzgl1T5LMmUFO3tmnSSGIQn+N+O1wenzEt+CusgAVeIqUM59HYxX9ZKQdwdYtxvNY1k1DsK1q0qEj8QjcUtueitWP8+4hTMVa8TPxyilYjzD/tdTebU/QDhZvQtQxeRUw0XN/+3rYCvJSaGVHZ6uT9tryqyYXUCd+OIfW9vihTRys6jx4yllb8skniHp6SC9uTLLz1SIK4uUz5W6r9SXZqXUU9X40I9byWWbdXfOolFT9JBOBPuMfUCyoiRBofbuGcnrEFwYzfuID3QU/Qc6JvZZHtb721c/t07DM5/1eIYj/Z9Kii/lusgEIat5U0KBH0PAYWH9sd4sd5JPVAu8q23B5xjE+HfCtzXbDY9IRgbrETcUnGXRrVSliY+fYhmk6fp68sx4T15kn88Dmk2V7MwMLW4LIxRKMLpYkeCKVepkTxbKwcLfMUTpcJAaypUWqHsTpW6xB1t0wf6VRcFzCo=
  on:
    tags: true
    repo: test-editor/web-workspace-navigator
    node: "6"
